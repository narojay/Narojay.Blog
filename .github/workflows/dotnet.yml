name: narojay.blog
on: 
 push:
  branches: [master]
 pull_request:
  branches: [master]
env:
    IMAGE_NAME: narojay/narojay.blog.api
    IMAGE_TAG: demo
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - uses: actions/checkout@v2
     - name: Setup .NET Core
       uses: actions/setup-dotnet@v1
       with:
        dotnet-version: 5.0.x
     - name: dotnet restore #还原包
       run: dotnet restore Narojay.Blog
     - name: dotnet publish #发布项目
       run: dotnet publish Narojay.Blog --configuration -c Release --no-restore -o app  
     - name: Run Crrpath
       run: ls 
     - name: upload files to server
       uses: vacare/anofuss-upload@v1
       with:
        host: ${{ secrets.Host }}
        username: ${{ secrets.UserName }}
        key: ${{ secrets.Password }}
        known_hosts: ${{ secrets.Known_Hosts }}
        source: ./app/
        target: /www/wwwroot/blogapi.narojay.site
     - name: start application
       uses: garygrossgarten/github-action-ssh@v0.6.3
       with:
        command: /www/server/panel/pyenv/bin/supervisorctl reload
        host: ${{ secrets.Host }}
        username: ${{ secrets.UserName }}
        privateKey: ${{ secrets.Password }}
